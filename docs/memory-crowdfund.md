# å…¨çƒåœ°åœ–å‹Ÿè³‡ç³»çµ±è¨˜æ†¶åº« (Crowdfund System)

## æ¨¡çµ„ç¯„åœ

åœ‹å®¶ç´šå‹Ÿè³‡è§£é–æ©Ÿåˆ¶ï¼Œè®“ç”¨æˆ¶åƒèˆ‡å¹³å°æ“´å±•ï¼Œåˆ†æ”¤æ™¯é»è³‡æ–™æ¡é›†æˆæœ¬ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µ

```
ç”¨æˆ¶æƒ³å»æŸåœ‹æ—…éŠ
       â”‚
       â–¼
è©²åœ‹å°šæœªè§£é–ï¼ˆæ²’æœ‰æ™¯é»è³‡æ–™ï¼‰
       â”‚
       â–¼
åƒèˆ‡å‹Ÿè³‡ â†’ é€²åº¦æ¢æ¨é€²
       â”‚
       â–¼
é”æ¨™ â†’ ç³»çµ±æ¡é›†è©²åœ‹æ™¯é»
       â”‚
       â–¼
æŠ•è³‡è€…ç²å¾—ï¼šå°ˆå±¬æˆå°± + å„ªå…ˆæŠ½å–æ¬Š
```

---

## å‹Ÿè³‡è¨­è¨ˆ

### å‹Ÿè³‡å–®ä½

| é …ç›® | è¨­è¨ˆ |
|------|------|
| å–®ä½ | **åœ‹å®¶** |
| é¡¯ç¤º | é€²åº¦æ¢ + å·²å‹Ÿé‡‘é¡ + ç™¾åˆ†æ¯” |
| ç›®æ¨™ | ä¾åœ‹å®¶è¦æ¨¡é ä¼°ï¼ˆè¦‹ä¸‹è¡¨ï¼‰|

### åœ‹å®¶å‹Ÿè³‡ç›®æ¨™åƒè€ƒ

| åœ‹å®¶è¦æ¨¡ | é ä¼°æ™¯é»æ•¸ | å‹Ÿè³‡ç›®æ¨™ | æ¡é›†æˆæœ¬é ä¼° |
|----------|-----------|----------|-------------|
| å°å‹ï¼ˆå¦‚ï¼šæ–°åŠ å¡ï¼‰| 500-1,000 | NT$ 30,000 | API + AI è™•ç† |
| ä¸­å‹ï¼ˆå¦‚ï¼šæ³°åœ‹ï¼‰| 2,000-5,000 | NT$ 80,000 | |
| å¤§å‹ï¼ˆå¦‚ï¼šæ—¥æœ¬ï¼‰| 10,000+ | NT$ 200,000 | |

> å¯¦éš›ç›®æ¨™ç”±ç‡Ÿé‹åœ˜éšŠæ ¹æ“š Google Places API æˆæœ¬ + AI è™•ç†æˆæœ¬è©•ä¼°

### å‹Ÿè³‡ç‹€æ…‹

```typescript
type CampaignStatus =
  | 'upcoming'    // å³å°‡é–‹å§‹
  | 'active'      // å‹Ÿè³‡ä¸­
  | 'completed'   // å·²é”æ¨™
  | 'collecting'  // æ¡é›†ä¸­
  | 'launched'    // å·²ä¸Šç·š
  | 'failed';     // æœªé”æ¨™ï¼ˆå¯é¸ï¼šé€€æ¬¾æˆ–è½‰ä¸‹æœŸï¼‰
```

---

## é‡‘æµè¨­è¨ˆ

### é›™æ¸ é“

| æ¸ é“ | é‡‘æµ | åˆ†æ½¤ | å‚™è¨» |
|------|------|------|------|
| APP | IAPï¼ˆApple/Googleï¼‰| 30% | ä¸å¯å¼•å°è‡³å®˜ç¶² |
| å®˜ç¶² | Stripe | 2.9% + NT$9 | ç”¨æˆ¶è‡ªè¡Œé¸æ“‡ |

### é‡‘æµæ•´åˆ

```
APP ç”¨æˆ¶è³¼è²·
       â”‚
       â–¼
IAP å®Œæˆ â†’ é©—è­‰æ”¶æ“š
       â”‚
       â–¼
å¾Œç«¯ API: POST /api/crowdfund/contribute
       â”‚
       â–¼
æ›´æ–° crowdfund_contributions
       â”‚
       â–¼
æ›´æ–° campaign é€²åº¦
```

```
å®˜ç¶²ç”¨æˆ¶è³¼è²·
       â”‚
       â–¼
Stripe Checkout â†’ Webhook
       â”‚
       â–¼
å¾Œç«¯ API: POST /api/crowdfund/contribute
       â”‚
       â–¼
åŒä¸Šæµç¨‹
```

### é€²åº¦åŒæ­¥

- å®˜ç¶²/APP å³æ™‚åŒæ­¥ï¼ˆWebSocket æˆ–è¼ªè©¢ï¼‰
- é¡¯ç¤ºï¼šå·²å‹Ÿé‡‘é¡ã€ç™¾åˆ†æ¯”ã€åƒèˆ‡äººæ•¸

---

## å‹Ÿè³‡çå‹µ

### åƒèˆ‡è€…çå‹µ

| çå‹µ | èªªæ˜ |
|------|------|
| ç¶“é©—å€¼ | é¦–æ¬¡åƒèˆ‡ +150ã€é”æ¨™ +300 |
| å°ˆå±¬æˆå°± | è¦‹ `memory-economy-system.md` æŠ•è³‡è€…ç·š |
| å„ªå…ˆæŠ½å–æ¬Š | é”æ¨™å¾Œ 24 å°æ™‚å…§å¯å„ªå…ˆæŠ½å–è©²åœ‹æ™¯é» |

### æˆå°±é€£å‹•

| æˆå°± | æ¢ä»¶ | çå‹µ |
|------|------|------|
| é–‹æ‹“å…ˆé‹’ | é¦–æ¬¡åƒèˆ‡å‹Ÿè³‡ | ã€Œå…ˆé‹’ã€å¾½ç«  |
| åœ°åœ–è§£é–è€… | åƒèˆ‡çš„å‹Ÿè³‡é”æ¨™ | å„ªå…ˆæŠ½å–æ¬Š |
| é›™åœ‹é–‹æ‹“ | 2 åœ‹å‹Ÿè³‡é”æ¨™ | é–‹æ‹“è€…é ­æ¡† |
| ä¸–ç•Œé–‹æ‹“è€… | 5 åœ‹å‹Ÿè³‡é”æ¨™ | é‡‘è‰²ç¨±è™Ÿ |
| å‰µä¸–è´ŠåŠ©è€… | ç´¯è¨ˆå‹Ÿè³‡å‰ 10% | å‚³èªªé ­æ¡† + åå­—ä¸Šç‰† |

---

## é”æ¨™å¾Œæµç¨‹

```
å‹Ÿè³‡é”æ¨™
    â”‚
    â–¼
ç‹€æ…‹è®Šæ›´ç‚º 'completed'
    â”‚
    â–¼
é€šçŸ¥æ‰€æœ‰åƒèˆ‡è€…ï¼ˆæ¨æ’­ + ç«™å…§ä¿¡ï¼‰
    â”‚
    â–¼
ç‹€æ…‹è®Šæ›´ç‚º 'collecting'
    â”‚
    â–¼
åŸ·è¡Œæ¡é›†è…³æœ¬ï¼ˆbatch-parallel-collect.tsï¼‰
    â”‚
    â–¼
AI å¯©æ ¸ + å‡ç´šåˆ°æ­£å¼è¡¨
    â”‚
    â–¼
ç‹€æ…‹è®Šæ›´ç‚º 'launched'
    â”‚
    â–¼
é€šçŸ¥åƒèˆ‡è€…ã€Œè©²åœ‹å·²ä¸Šç·šã€
    â”‚
    â–¼
åƒèˆ‡è€… 24hr å„ªå…ˆæŠ½å–æ¬Šç”Ÿæ•ˆ
```

---

## API è¨­è¨ˆ

### å‹Ÿè³‡æ´»å‹•

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| GET | `/api/crowdfund/campaigns` | æ‰€æœ‰å‹Ÿè³‡æ´»å‹• |
| GET | `/api/crowdfund/campaigns/:id` | å–®ä¸€æ´»å‹•è©³æƒ… |
| GET | `/api/crowdfund/campaigns/country/:countryCode` | ä¾åœ‹å®¶æŸ¥è©¢ |

### åƒèˆ‡å‹Ÿè³‡

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| POST | `/api/crowdfund/contribute` | åƒèˆ‡å‹Ÿè³‡ï¼ˆIAP/Stripe é©—è­‰å¾Œï¼‰|
| GET | `/api/crowdfund/my-contributions` | æˆ‘çš„å‹Ÿè³‡è¨˜éŒ„ |

### ç®¡ç†ï¼ˆAdminï¼‰

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| POST | `/api/admin/crowdfund/campaigns` | å»ºç«‹å‹Ÿè³‡æ´»å‹• |
| PATCH | `/api/admin/crowdfund/campaigns/:id` | æ›´æ–°æ´»å‹• |
| POST | `/api/admin/crowdfund/campaigns/:id/launch` | æ‰‹å‹•è§¸ç™¼ä¸Šç·š |

---

## è³‡æ–™è¡¨è¨­è¨ˆ

```typescript
// å‹Ÿè³‡æ´»å‹•
crowdfundCampaigns {
  id: serial PK,
  countryCode: string,        // 'JP', 'TH', 'SG'
  countryNameZh: string,      // 'æ—¥æœ¬'
  countryNameEn: string,      // 'Japan'
  goalAmount: number,         // ç›®æ¨™é‡‘é¡ï¼ˆNT$ï¼‰
  currentAmount: number,      // å·²å‹Ÿé‡‘é¡
  contributorCount: number,   // åƒèˆ‡äººæ•¸
  estimatedPlaces: number,    // é ä¼°æ™¯é»æ•¸
  status: CampaignStatus,
  startDate: timestamp,
  endDate: timestamp | null,  // null = ç„¡æœŸé™
  launchedAt: timestamp | null,
  createdAt: timestamp,
  updatedAt: timestamp
}

// å‹Ÿè³‡è²¢ç»
crowdfundContributions {
  id: serial PK,
  campaignId: number FK,
  userId: string FK,
  amount: number,             // è²¢ç»é‡‘é¡
  paymentMethod: 'iap_apple' | 'iap_google' | 'stripe',
  transactionId: string,      // é‡‘æµäº¤æ˜“ ID
  receiptData: jsonb | null,  // IAP æ”¶æ“šï¼ˆé©—è­‰ç”¨ï¼‰
  status: 'pending' | 'verified' | 'failed',
  priorityAccessUsed: boolean, // æ˜¯å¦å·²ä½¿ç”¨å„ªå…ˆæŠ½å–æ¬Š
  createdAt: timestamp
}

// Index
// - (campaignId, status)
// - (userId, createdAt)
// - (transactionId) UNIQUE
```

---

## å‰ç«¯é¡¯ç¤º

### å…¨çƒåœ°åœ–é é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ å…¨çƒåœ°åœ–                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [å·²è§£é–] å°ç£ ğŸ‡¹ğŸ‡¼                        â”‚
â”‚  [å·²è§£é–] æ—¥æœ¬ ğŸ‡¯ğŸ‡µ                        â”‚
â”‚                                         â”‚
â”‚  [å‹Ÿè³‡ä¸­] æ³°åœ‹ ğŸ‡¹ğŸ‡­                        â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 65% (NT$ 52,000)      â”‚
â”‚  [åƒèˆ‡å‹Ÿè³‡]                              â”‚
â”‚                                         â”‚
â”‚  [å³å°‡é–‹æ”¾] éŸ“åœ‹ ğŸ‡°ğŸ‡·                      â”‚
â”‚  é è¨ˆç›®æ¨™ï¼šNT$ 100,000                   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‹Ÿè³‡è©³æƒ…é 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‡¹ğŸ‡­ æ³°åœ‹å‹Ÿè³‡                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ç›®æ¨™ï¼šNT$ 80,000                        â”‚
â”‚  å·²å‹Ÿï¼šNT$ 52,000 (65%)                  â”‚
â”‚  åƒèˆ‡äººæ•¸ï¼š127 äºº                        â”‚
â”‚                                         â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚
â”‚                                         â”‚
â”‚  é è¨ˆæ™¯é»ï¼š3,000+                        â”‚
â”‚  é è¨ˆä¸Šç·šï¼šé”æ¨™å¾Œ 2 é€±å…§                  â”‚
â”‚                                         â”‚
â”‚  [NT$ 100] [NT$ 500] [NT$ 1,000] [è‡ªè¨‚]  â”‚
â”‚                                         â”‚
â”‚  åƒèˆ‡è€…å°‡ç²å¾—ï¼š                          â”‚
â”‚  âœ“ é–‹æ‹“è€…æˆå°±                           â”‚
â”‚  âœ“ ä¸Šç·šå¾Œ 24hr å„ªå…ˆæŠ½å–æ¬Š               â”‚
â”‚  âœ“ åå­—é¡¯ç¤ºåœ¨è´ŠåŠ©è€…åå–®                  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## èˆ‡å…¶ä»–æ¨¡çµ„çš„é—œè¯

- **ç¶“æ¿Ÿç³»çµ±**: åƒèˆ‡å‹Ÿè³‡ â†’ è§¸ç™¼ç¶“é©—å€¼ + æˆå°±
- **æˆå°±ç³»çµ±**: æŠ•è³‡è€…æˆå°±ç·š
- **æ‰­è›‹æ¨¡çµ„**: å„ªå…ˆæŠ½å–æ¬Šï¼ˆ24hr å…§è©²åœ‹æ™¯é»å„ªå…ˆï¼‰
- **æ¡é›†è…³æœ¬**: é”æ¨™å¾Œè§¸ç™¼ `batch-parallel-collect.ts`
- **é€šçŸ¥ç³»çµ±**: é”æ¨™/ä¸Šç·šé€šçŸ¥

---

## å¾…é–‹ç™¼åŠŸèƒ½

- [ ] å‹Ÿè³‡æ´»å‹• CRUD API
- [ ] IAP æ”¶æ“šé©—è­‰
- [ ] Stripe Webhook è™•ç†
- [ ] é€²åº¦å³æ™‚åŒæ­¥
- [ ] å„ªå…ˆæŠ½å–æ¬Šé‚è¼¯
- [ ] é”æ¨™è‡ªå‹•è§¸ç™¼æ¡é›†
- [ ] Admin å¾Œå°ç®¡ç†é é¢
