# ğŸ“± App åŒæ­¥æŒ‡ä»¤

> æ­¤æª”æ¡ˆç”±å¾Œç«¯è‡ªå‹•æ›´æ–°ï¼Œå‰ç«¯ Claude Code è®€å–å¾ŒåŸ·è¡Œ

---

## æœ€æ–°æ›´æ–°

### 2026-01-16 #002ï¼šğŸ§¹ æ–‡ä»¶æ¸…ç† - æ­¸æª”èˆŠæ–‡ä»¶

**è®Šæ›´é¡å‹**: ğŸŸ¡ æ–‡ä»¶æ•´ç†ï¼ˆé API è®Šæ›´ï¼‰

**èƒŒæ™¯èªªæ˜**:
å¾Œç«¯å·²å®Œæˆæ–‡ä»¶æ¸…ç†ï¼Œå°‡èˆŠè¦åŠƒæ–‡ä»¶ç§»åˆ° `archive/`ï¼Œä¸¦æ‹†åˆ†éå¤§çš„è¨˜æ†¶åº«ã€‚APP ä¹Ÿéœ€è¦æª¢æŸ¥ä¸¦æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶ã€‚

---

#### APP éœ€è¦åšçš„äº‹

##### 1. æª¢æŸ¥ docs/ ç›®éŒ„

æƒæä»¥ä¸‹é¡å‹çš„æ–‡ä»¶ï¼Œè©•ä¼°æ˜¯å¦éœ€è¦æ­¸æª”ï¼š

| é¡å‹ | åˆ¤æ–·æ¨™æº– | å‹•ä½œ |
|------|----------|------|
| ä¸€æ¬¡æ€§å ±å‘Šï¼ˆaudit, reportï¼‰ | å·²éæ™‚ | ç§»åˆ° `docs/archive/` |
| èˆŠè¦åŠƒæ–‡ä»¶ï¼ˆplan, blueprintï¼‰ | å·²å¯¦ä½œå®Œæˆ | ç§»åˆ° `docs/archive/` |
| èˆ‡å¾Œç«¯é‡è¤‡çš„æ–‡ä»¶ | å¾Œç«¯æœ‰æ›´æ–°ç‰ˆæœ¬ | åˆªé™¤æˆ–æ­¸æª” |
| éå¤§çš„è¨˜æ†¶åº«ï¼ˆ>30KBï¼‰ | é›£ä»¥ç¶­è­· | è€ƒæ…®æ‹†åˆ† |

##### 2. å»ºç«‹ `docs/archive/` ç›®éŒ„ï¼ˆå¦‚æœæœ‰éœ€è¦æ­¸æª”çš„æ–‡ä»¶ï¼‰

##### 3. æª¢æŸ¥è¨˜æ†¶åº«å¤§å°

```bash
ls -lh docs/memory-*.md
```

å¦‚æœæœ‰è¶…é 30KB çš„è¨˜æ†¶åº«ï¼Œè€ƒæ…®æ‹†åˆ†ã€‚

##### 4. æ›´æ–° CLAUDE.mdï¼ˆå¦‚æœæœ‰æ–‡ä»¶è®Šå‹•ï¼‰

ç¢ºä¿ã€Œå¼·åˆ¶æŸ¥é–±è¦å‰‡ã€æŒ‡å‘æ­£ç¢ºçš„è¨˜æ†¶åº«ã€‚

---

#### é©—è­‰æ–¹å¼

1. æ²’æœ‰éæ™‚çš„ä¸€æ¬¡æ€§å ±å‘Šç•™åœ¨ `docs/` æ ¹ç›®éŒ„
2. è¨˜æ†¶åº«å¤§å°éƒ½åœ¨åˆç†ç¯„åœï¼ˆ<30KBï¼‰
3. CLAUDE.md çš„å¼·åˆ¶æŸ¥é–±è¦å‰‡æŒ‡å‘æ­£ç¢ºæ–‡ä»¶

---

#### å®Œæˆå¾Œ

1. Commit + Push
2. åœ¨ `docs/sync-backend.md` è¨˜éŒ„å®Œæˆç‹€æ…‹ï¼ˆ#002ï¼‰
3. å†æ¬¡ Commit + Push

---

### 2026-01-16 #001ï¼šğŸ”§ æ¶æ§‹å‡ç´š - ä¸‰ç«¯å”ä½œè¦ç¯„

**è®Šæ›´é¡å‹**: ğŸ”´ æ¶æ§‹å‡ç´šï¼ˆé API è®Šæ›´ï¼‰

**èƒŒæ™¯èªªæ˜**:
å¾Œç«¯å·²å»ºç«‹ã€Œä¸‰ç«¯å”ä½œè¦ç¯„ã€ï¼Œå®šç¾©å¾Œç«¯/APP/å®˜ç¶²çš„å”ä½œæ¡†æ¶ã€‚APP éœ€è¦é…åˆå»ºç«‹å°æ‡‰æ–‡ä»¶ã€‚

**å”ä½œè¦ç¯„æ–‡ä»¶ä½ç½®**:
- å¾Œç«¯ï¼š`docs/COLLABORATION.md`
- GitHubï¼šhttps://github.com/chaosmibu-blip/MIBU_REPLIT/blob/main/docs/COLLABORATION.md

---

#### APP éœ€è¦åšçš„äº‹

##### 1. å»ºç«‹ `docs/sync-backend.md`

ç”¨é€”ï¼šå›å ±å¾Œç«¯åŒæ­¥æŒ‡ä»¤çš„å®Œæˆç‹€æ…‹

```markdown
# ğŸ”„ å¾Œç«¯åŒæ­¥å›å ±

> APP å®Œæˆå¾Œç«¯åŒæ­¥æŒ‡ä»¤å¾Œï¼Œåœ¨æ­¤è¨˜éŒ„ç‹€æ…‹

---

## æœ€æ–°å›å ±

### 2026-01-16 #001

| é …ç›® | å…§å®¹ |
|------|------|
| ä¾†æº | å¾Œç«¯ sync-app.md #001 |
| æ”¶åˆ°æ™‚é–“ | YYYY-MM-DD HH:MM |
| å®Œæˆæ™‚é–“ | YYYY-MM-DD HH:MM |
| ç‹€æ…‹ | âœ… å®Œæˆ / ğŸ”„ é€²è¡Œä¸­ / âŒ æœ‰å•é¡Œ |

### å®Œæˆé …ç›®
- [ ] å»ºç«‹ docs/sync-backend.md
- [ ] æ›´æ–° CLAUDE.md åŠ å…¥ã€Œä¸‰ç«¯å”ä½œã€æ®µè½

### ç•°å¸¸å›å ±
ï¼ˆå¦‚æœæœ‰å•é¡Œï¼Œå¯«åœ¨é€™è£¡è®“å¾Œç«¯ AI çŸ¥é“ï¼‰

---

## æ­·å²å›å ±

ï¼ˆèˆŠçš„å›å ±å¾€ä¸‹ç§»å‹•ï¼‰
```

##### 2. æ›´æ–° CLAUDE.md

åœ¨ CLAUDE.md é–‹é ­çš„ã€Œå°ˆæ¡ˆå®šä½ã€æ®µè½ä¹‹å¾Œï¼ŒåŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š

```markdown
## ä¸‰ç«¯å”ä½œ

> - å¾Œç«¯ GitHub: https://github.com/chaosmibu-blip/MIBU_REPLIT
> - APP GitHub: https://github.com/chaosmibu-blip/Mibu-Replit-APP-
> - å®˜ç¶² GitHub: https://github.com/chaosmibu-blip/Mibu-Pages
> - å”ä½œè¦ç¯„ï¼šå¾Œç«¯ `docs/COLLABORATION.md`
> - åŒæ­¥æ©Ÿåˆ¶ï¼š
>   - è®€å–ï¼šå¾Œç«¯ `docs/sync-app.md`
>   - å›å ±ï¼šæœ¬å°ˆæ¡ˆ `docs/sync-backend.md`
```

##### 3. åœ¨å„è¨˜æ†¶åº«åŠ å…¥ã€Œè·¨ç«¯å°æ‡‰ã€æ¨™è¨»

åœ¨æ¯å€‹ `docs/memory-*.md` é–‹é ­åŠ å…¥ï¼š

```markdown
> **è·¨ç«¯å°æ‡‰**
> - å¾Œç«¯ï¼š`docs/memory-xxx.md`ï¼ˆå°æ‡‰çš„å¾Œç«¯è¨˜æ†¶åº«ï¼‰
> - å®˜ç¶²ï¼šï¼ˆå¦‚æœ‰å°æ‡‰ï¼‰
```

å°æ‡‰é—œä¿‚åƒè€ƒï¼š
| APP è¨˜æ†¶åº« | å°æ‡‰å¾Œç«¯è¨˜æ†¶åº« |
|------------|----------------|
| `memory-screens.md` | `memory-travel-gacha.md`ï¼ˆæ‰­è›‹ç•«é¢ï¼‰ã€`memory-merchant.md`ï¼ˆå•†å®¶ç•«é¢ï¼‰ |
| `memory-auth-flow.md` | `memory-auth.md` |
| `memory-api-client.md` | `docs/contracts/APP.md` |
| `memory-components.md` | ï¼ˆç„¡ç›´æ¥å°æ‡‰ï¼Œå‰ç«¯å°ˆå±¬ï¼‰ |
| `memory-state.md` | ï¼ˆç„¡ç›´æ¥å°æ‡‰ï¼Œå‰ç«¯å°ˆå±¬ï¼‰ |
| `memory-assets.md` | ï¼ˆç„¡ç›´æ¥å°æ‡‰ï¼Œå‰ç«¯å°ˆå±¬ï¼‰ |

---

#### é©—è­‰æ–¹å¼

1. `docs/sync-backend.md` æª”æ¡ˆå­˜åœ¨
2. CLAUDE.md åŒ…å«ã€Œä¸‰ç«¯å”ä½œã€æ®µè½
3. è¨˜æ†¶åº«æœ‰ã€Œè·¨ç«¯å°æ‡‰ã€æ¨™è¨»

---

#### å®Œæˆå¾Œ

1. Commit + Push
2. åœ¨ `docs/sync-backend.md` è¨˜éŒ„å®Œæˆç‹€æ…‹
3. å†æ¬¡ Commit + Push

---

### 2026-01-12ï¼šæ–°å¢åˆªé™¤å„ªæƒ åˆ¸ API + Gacha éŒ¯èª¤æ ¼å¼ä¿®æ­£

**è®Šæ›´é¡å‹**: API æ–°å¢ + API ä¿®æ”¹

---

#### 1. æ–°å¢ DELETE /api/coupons/:id

**Endpoint**:
```
DELETE /api/coupons/:id
```

**Headers**:
```
Authorization: Bearer <jwt_token>
```

**Response (æˆåŠŸ)**:
```json
{ "success": true, "message": "å„ªæƒ åˆ¸å·²åˆªé™¤" }
```

**Response (å¤±æ•—)**:
```json
{ "error": "ç„¡æ¬Šé™åˆªé™¤æ­¤å„ªæƒ åˆ¸", "code": "FORBIDDEN" }
{ "error": "å„ªæƒ åˆ¸ä¸å­˜åœ¨", "code": "NOT_FOUND" }
```

**é‚è¼¯èªªæ˜**:
- è»Ÿåˆªé™¤ï¼šè¨­ç‚º `archived: true` + `isActive: false`
- åªæœ‰å„ªæƒ åˆ¸æ“æœ‰è€…ï¼ˆå•†å®¶ï¼‰å¯ä»¥åˆªé™¤

---

#### 2. Gacha /gacha/pull/v3 éŒ¯èª¤æ ¼å¼ä¿®æ­£

**ä¿®æ”¹å‰**:
```json
{ "error": "Authentication required" }
{ "error": ["zod errors..."] }
{ "error": "Failed to perform gacha pull" }
```

**ä¿®æ”¹å¾Œ**:
```json
{ "error": "Authentication required", "code": "UNAUTHORIZED" }
{ "error": "åƒæ•¸æ ¼å¼éŒ¯èª¤", "code": "VALIDATION_ERROR", "details": [...] }
{ "error": "æŠ½å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦", "code": "SERVER_ERROR" }
```

**å‰ç«¯éœ€è¦åšçš„äº‹**:
- [ ] å¦‚æœ‰å•†å®¶åŠŸèƒ½ï¼Œæ–°å¢åˆªé™¤å„ªæƒ åˆ¸æŒ‰éˆ•å‘¼å« `DELETE /api/coupons/:id`
- [x] Gacha éŒ¯èª¤è™•ç†å·²å¯ä½¿ç”¨ `response.code` åˆ¤æ–·

---

### 2026-01-12ï¼šèªè­‰éŒ¯èª¤æ ¼å¼çµ±ä¸€

**è®Šæ›´é¡å‹**: API ä¿®æ”¹ï¼ˆéŒ¯èª¤å›æ‡‰æ ¼å¼ï¼‰

**å½±éŸ¿ç¯„åœ**: æ‰€æœ‰éœ€è¦èªè­‰çš„ API ç«¯é»

**ä¿®æ”¹å‰çš„éŒ¯èª¤æ ¼å¼**:
```typescript
// å¾Œç«¯è¿”å›ï¼ˆä¸ç¬¦åˆè¦ç¯„ï¼‰
{ message: "Unauthorized" }
{ message: "Invalid token" }
{ message: "User not found" }
{ message: "Forbidden: insufficient permissions" }
```

**ä¿®æ”¹å¾Œçš„éŒ¯èª¤æ ¼å¼**:
```typescript
// æ¨™æº–åŒ–éŒ¯èª¤å›æ‡‰
interface ApiError {
  error: string;  // äººé¡å¯è®€è¨Šæ¯
  code: string;   // æ©Ÿå™¨å¯è®€ä»£ç¢¼
}

// 401 éŒ¯èª¤
{ error: "Unauthorized", code: "UNAUTHORIZED" }
{ error: "Invalid token", code: "INVALID_TOKEN" }
{ error: "User not found", code: "USER_NOT_FOUND" }

// 403 éŒ¯èª¤
{ error: "Forbidden: insufficient permissions", code: "FORBIDDEN" }
```

**cURL æ¸¬è©¦**:
```bash
# æ¸¬è©¦ç„¡ Token è«‹æ±‚ï¼ˆæ‡‰è¿”å› 401ï¼‰
curl -X POST https://gacha-travel--s8869420.replit.app/api/gacha/itinerary/v3 \
  -H "Content-Type: application/json" \
  -d '{"regionId": 1, "days": 1}'

# é æœŸå›æ‡‰
{ "error": "Unauthorized", "code": "UNAUTHORIZED" }
```

**é‚è¼¯èªªæ˜**:
- çµ±ä¸€æ‰€æœ‰èªè­‰éŒ¯èª¤çš„å›æ‡‰æ ¼å¼ç‚º `{ error, code }`
- å‰ç«¯å¯é€é `response.error` æˆ– `response.code` åˆ¤æ–·éŒ¯èª¤é¡å‹
- ä¿®æ­£äº† 20% ç”¨æˆ¶ã€ŒæŸ¥ç„¡æ™¯é»ã€èª¤å ±å•é¡Œçš„å¾Œç«¯éƒ¨åˆ†

**å‰ç«¯éœ€è¦åšçš„äº‹**:
- [x] å·²æ–°å¢ `response.message` æª¢æŸ¥ï¼ˆç›¸å®¹èˆŠæ ¼å¼ï¼‰
- [x] å·²æ–°å¢ Token å‰ç½®æª¢æŸ¥
- [ ] å¯é¸ï¼šç§»é™¤ `response.message` æª¢æŸ¥ï¼ˆå¾Œç«¯å·²ä¸å†ä½¿ç”¨ï¼‰
- [ ] å»ºè­°ï¼šçµ±ä¸€ä½¿ç”¨ `response.error` æˆ– `response.code` åˆ¤æ–·éŒ¯èª¤

---

## æ­·å²è¨˜éŒ„

(ç„¡æ­·å²è¨˜éŒ„)
