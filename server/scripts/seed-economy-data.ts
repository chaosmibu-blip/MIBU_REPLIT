/**
 * éŠæˆ²ç¶“æ¿Ÿç³»çµ±åˆå§‹è³‡æ–™
 * åŸ·è¡Œ: npx tsx server/scripts/seed-economy-data.ts
 */

import { db } from "../db";
import { levelDefinitions, achievements } from "../../shared/schema";

// ç­‰ç´šå®šç¾©è³‡æ–™ (Lv.1-30)
const levelData = [
  { level: 1, requiredExp: 0, title: "æ–°æ‰‹æ—…äºº", titleEn: "Novice Traveler", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 24, inventorySlots: 20 } },
  { level: 2, requiredExp: 50, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 3, requiredExp: 120, title: "åˆå¿ƒè€…", titleEn: "Beginner", isMilestone: true, isUnlocked: true, perks: { title: "åˆå¿ƒè€…" } },
  { level: 4, requiredExp: 210, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 5, requiredExp: 330, title: "æ¢ç´¢è€…", titleEn: "Explorer", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 26, inventorySlots: 22, frame: "explorer" } },
  { level: 6, requiredExp: 480, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 7, requiredExp: 670, title: "è²¢ç»è€…", titleEn: "Contributor", isMilestone: true, isUnlocked: true, perks: { badge: "contributor" } },
  { level: 8, requiredExp: 900, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 9, requiredExp: 1180, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 10, requiredExp: 1500, title: "è³‡æ·±æ—…äºº", titleEn: "Senior Traveler", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 28, frame: "senior" } },
  { level: 11, requiredExp: 1900, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 12, requiredExp: 2400, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 13, requiredExp: 3000, title: "å®ˆè­·è€…", titleEn: "Guardian", isMilestone: true, isUnlocked: true, perks: { inventorySlots: 24, badge: "guardian" } },
  { level: 14, requiredExp: 3700, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 15, requiredExp: 4500, title: "å†’éšªå®¶", titleEn: "Adventurer", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 30, frame: "adventurer" } },
  { level: 16, requiredExp: 5400, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 17, requiredExp: 6400, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 18, requiredExp: 7500, title: "é–‹æ‹“è€…", titleEn: "Pioneer", isMilestone: true, isUnlocked: true, perks: { inventorySlots: 26, title: "é–‹æ‹“è€…" } },
  { level: 19, requiredExp: 8700, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 20, requiredExp: 10000, title: "è¡Œè€…", titleEn: "Wayfarer", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 32, inventorySlots: 28, frame: "wayfarer" } },
  { level: 21, requiredExp: 11500, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 22, requiredExp: 13200, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 23, requiredExp: 15100, title: "å°èˆªè€…", titleEn: "Navigator", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 34, badge: "navigator" } },
  { level: 24, requiredExp: 17200, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 25, requiredExp: 19500, title: "é ˜è·¯äºº", titleEn: "Pathfinder", isMilestone: true, isUnlocked: true, perks: { inventorySlots: 29, frame: "pathfinder" } },
  { level: 26, requiredExp: 22000, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 27, requiredExp: 24700, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 28, requiredExp: 27600, title: "å…ˆé©…è€…", titleEn: "Trailblazer", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 35, title: "å…ˆé©…è€…" } },
  { level: 29, requiredExp: 30700, title: "æ—…äºº", titleEn: "Traveler", isMilestone: false, isUnlocked: true, perks: null },
  { level: 30, requiredExp: 34000, title: "æ—…é€”å¤§å¸«", titleEn: "Journey Master", isMilestone: true, isUnlocked: true, perks: { dailyPulls: 36, inventorySlots: 30, frame: "legend" } },
];

// æˆå°±å®šç¾©è³‡æ–™
const achievementData = [
  // åƒèˆ‡è€…ç·šï¼ˆæ”¶è—å®¶/æ¢ç´¢å®¶ï¼‰
  {
    code: "COLLECTOR_STARTER",
    category: "collector",
    nameZh: "åˆå¿ƒæ”¶è—å®¶",
    nameEn: "Beginner Collector",
    description: "æ”¶é›† 30 å€‹åœ–é‘‘æ™¯é»",
    descriptionEn: "Collect 30 places in your collection",
    rarity: 1,
    triggerCondition: { type: "count", target: "collections", value: 30 },
    expReward: 30,
    otherRewards: { title: "æ”¶è—å®¶" },
    sortOrder: 1,
  },
  {
    code: "CITY_EXPLORER_5",
    category: "collector",
    nameZh: "åŸå¸‚æ¢ç´¢è€…",
    nameEn: "City Explorer",
    description: "æ¢ç´¢ 5 å€‹ä¸åŒåŸå¸‚",
    descriptionEn: "Explore 5 different cities",
    rarity: 1,
    triggerCondition: { type: "count", target: "cities_explored", value: 5 },
    expReward: 30,
    otherRewards: { frame: "explorer" },
    sortOrder: 2,
  },
  {
    code: "FOOD_HUNTER_30",
    category: "collector",
    nameZh: "ç¾é£Ÿçµäºº",
    nameEn: "Food Hunter",
    description: "æ”¶é›† 30 å€‹ç¾é£Ÿé¡æ™¯é»",
    descriptionEn: "Collect 30 food places",
    rarity: 2,
    triggerCondition: { type: "count", target: "collections", value: 30, filters: { category: "ç¾é£Ÿ" } },
    expReward: 80,
    otherRewards: { frame: "food_hunter" },
    sortOrder: 3,
  },
  {
    code: "CITY_CONQUEROR",
    category: "collector",
    nameZh: "åŸå¸‚å¾æœè€…",
    nameEn: "City Conqueror",
    description: "å®Œæˆä¸€å€‹åŸå¸‚çš„ 100% åœ–é‘‘",
    descriptionEn: "Complete 100% collection of a city",
    rarity: 3,
    triggerCondition: { type: "milestone", target: "city_completion", value: 100 },
    expReward: 200,
    otherRewards: { frame: "conqueror" },
    sortOrder: 4,
  },
  {
    code: "RAINBOW_MASTER",
    category: "collector",
    nameZh: "ä¸ƒå½©å¤§å¸«",
    nameEn: "Rainbow Master",
    description: "ä¸ƒå¤§åˆ†é¡å„æ”¶é›† 20 å€‹æ™¯é»",
    descriptionEn: "Collect 20 places in each of 7 categories",
    rarity: 4,
    triggerCondition: { type: "milestone", target: "category_completion", value: 20 },
    expReward: 500,
    otherRewards: { frame: "legend_collector" },
    sortOrder: 5,
  },
  {
    code: "WORLD_TRAVELER",
    category: "collector",
    nameZh: "ä¸–ç•Œæ—…äºº",
    nameEn: "World Traveler",
    description: "æ¢ç´¢ 15 å€‹ä¸åŒåŸå¸‚",
    descriptionEn: "Explore 15 different cities",
    rarity: 4,
    triggerCondition: { type: "count", target: "cities_explored", value: 15 },
    expReward: 500,
    otherRewards: { title: "ä¸–ç•Œæ—…äºº" },
    sortOrder: 6,
  },

  // æŠ•è³‡è€…ç·šï¼ˆé–‹æ‹“è€…ï¼‰
  {
    code: "PIONEER_FIRST",
    category: "investor",
    nameZh: "é–‹æ‹“å…ˆé‹’",
    nameEn: "Pioneer",
    description: "é¦–æ¬¡åƒèˆ‡å‹Ÿè³‡",
    descriptionEn: "Participate in crowdfunding for the first time",
    rarity: 2,
    triggerCondition: { type: "milestone", target: "crowdfund_first", value: 1 },
    expReward: 80,
    otherRewards: { badge: "pioneer" },
    sortOrder: 10,
  },
  {
    code: "MAP_UNLOCKER",
    category: "investor",
    nameZh: "åœ°åœ–è§£é–è€…",
    nameEn: "Map Unlocker",
    description: "åƒèˆ‡çš„å‹Ÿè³‡æ´»å‹•é”æ¨™",
    descriptionEn: "Crowdfunding campaign you supported reached goal",
    rarity: 2,
    triggerCondition: { type: "milestone", target: "crowdfund_success", value: 1 },
    expReward: 80,
    otherRewards: null,
    sortOrder: 11,
  },
  {
    code: "DUAL_PIONEER",
    category: "investor",
    nameZh: "é›™åœ‹é–‹æ‹“",
    nameEn: "Dual Pioneer",
    description: "2 å€‹åœ‹å®¶å‹Ÿè³‡é”æ¨™",
    descriptionEn: "Supported campaigns reached goal in 2 countries",
    rarity: 3,
    triggerCondition: { type: "count", target: "crowdfund_countries_success", value: 2 },
    expReward: 200,
    otherRewards: { frame: "pioneer" },
    sortOrder: 12,
  },
  {
    code: "WORLD_PIONEER",
    category: "investor",
    nameZh: "ä¸–ç•Œé–‹æ‹“è€…",
    nameEn: "World Pioneer",
    description: "5 å€‹åœ‹å®¶å‹Ÿè³‡é”æ¨™",
    descriptionEn: "Supported campaigns reached goal in 5 countries",
    rarity: 4,
    triggerCondition: { type: "count", target: "crowdfund_countries_success", value: 5 },
    expReward: 500,
    otherRewards: { title: "é–‹æ‹“è€…" },
    sortOrder: 13,
  },
  {
    code: "GENESIS_SPONSOR",
    category: "investor",
    nameZh: "å‰µä¸–è´ŠåŠ©è€…",
    nameEn: "Genesis Sponsor",
    description: "ç´¯è¨ˆå‹Ÿè³‡é‡‘é¡å‰ 10%",
    descriptionEn: "Be in top 10% of total crowdfunding contributions",
    rarity: 4,
    triggerCondition: { type: "threshold", target: "crowdfund_total_percentile", value: 10 },
    expReward: 500,
    otherRewards: { frame: "genesis", badge: "genesis" },
    sortOrder: 14,
  },

  // æ¨å»£è€…ç·šï¼ˆç¤¾ç¾¤é ˜è¢–ï¼‰
  {
    code: "WORD_OF_MOUTH_3",
    category: "promoter",
    nameZh: "å£ç¢‘å‚³æ’­",
    nameEn: "Word of Mouth",
    description: "æ¨è–¦ 3 ä½ç”¨æˆ¶",
    descriptionEn: "Refer 3 users",
    rarity: 1,
    triggerCondition: { type: "count", target: "user_referrals", value: 3 },
    expReward: 30,
    otherRewards: { title: "å‚³æ’­è€…" },
    sortOrder: 20,
  },
  {
    code: "NETWORKER_10",
    category: "promoter",
    nameZh: "äººè„ˆé”äºº",
    nameEn: "Networker",
    description: "æ¨è–¦ 10 ä½ç”¨æˆ¶",
    descriptionEn: "Refer 10 users",
    rarity: 2,
    triggerCondition: { type: "count", target: "user_referrals", value: 10 },
    expReward: 80,
    otherRewards: { frame: "networker" },
    sortOrder: 21,
  },
  {
    code: "COMMUNITY_LEADER_30",
    category: "promoter",
    nameZh: "ç¤¾ç¾¤é ˜è¢–",
    nameEn: "Community Leader",
    description: "æ¨è–¦ 30 ä½ç”¨æˆ¶",
    descriptionEn: "Refer 30 users",
    rarity: 3,
    triggerCondition: { type: "count", target: "user_referrals", value: 30 },
    expReward: 200,
    otherRewards: { title: "é ˜è¢–" },
    sortOrder: 22,
  },
  {
    code: "INFLUENCE_MASTER_100",
    category: "promoter",
    nameZh: "å½±éŸ¿åŠ›å¤§å¸«",
    nameEn: "Influence Master",
    description: "æ¨è–¦ 100 ä½ç”¨æˆ¶",
    descriptionEn: "Refer 100 users",
    rarity: 4,
    triggerCondition: { type: "count", target: "user_referrals", value: 100 },
    expReward: 500,
    otherRewards: { frame: "legend_promoter" },
    sortOrder: 23,
  },

  // æ¥­å‹™ç·šï¼ˆå•†æ¥­å¤§ä½¿ï¼‰
  {
    code: "BUSINESS_PARTNER_1",
    category: "business",
    nameZh: "å•†æ¥­å¤¥ä¼´",
    nameEn: "Business Partner",
    description: "æ¨è–¦ 1 å®¶å•†å®¶",
    descriptionEn: "Refer 1 merchant",
    rarity: 2,
    triggerCondition: { type: "count", target: "merchant_referrals", value: 1 },
    expReward: 80,
    otherRewards: { badge: "partner" },
    sortOrder: 30,
  },
  {
    code: "BUSINESS_PRO_5",
    category: "business",
    nameZh: "æ¥­å‹™é”äºº",
    nameEn: "Business Pro",
    description: "æ¨è–¦ 5 å®¶å•†å®¶",
    descriptionEn: "Refer 5 merchants",
    rarity: 3,
    triggerCondition: { type: "count", target: "merchant_referrals", value: 5 },
    expReward: 200,
    otherRewards: { frame: "business" },
    sortOrder: 31,
  },
  {
    code: "BUSINESS_AMBASSADOR_10",
    category: "business",
    nameZh: "å•†æ¥­å¤§ä½¿",
    nameEn: "Business Ambassador",
    description: "æ¨è–¦ 10 å®¶å•†å®¶",
    descriptionEn: "Refer 10 merchants",
    rarity: 4,
    triggerCondition: { type: "count", target: "merchant_referrals", value: 10 },
    expReward: 500,
    otherRewards: { title: "å¤§ä½¿" },
    sortOrder: 32,
  },
  {
    code: "BUSINESS_MOGUL_30",
    category: "business",
    nameZh: "å•†æ¥­å·¨æ“˜",
    nameEn: "Business Mogul",
    description: "æ¨è–¦ 30 å®¶å•†å®¶",
    descriptionEn: "Refer 30 merchants",
    rarity: 4,
    triggerCondition: { type: "count", target: "merchant_referrals", value: 30 },
    expReward: 500,
    otherRewards: { frame: "legend_business" },
    sortOrder: 33,
  },

  // ç­–åŠƒå¸«ç·šï¼ˆæ—…é€”å¤§å¸«ï¼‰
  {
    code: "SPECIALIST_FIRST",
    category: "specialist",
    nameZh: "æ–°æ‰‹ç­–åŠƒå¸«",
    nameEn: "Novice Specialist",
    description: "å®Œæˆé¦–å–®æœå‹™",
    descriptionEn: "Complete first service order",
    rarity: 2,
    triggerCondition: { type: "milestone", target: "specialist_first_order", value: 1 },
    expReward: 80,
    otherRewards: { badge: "specialist" },
    sortOrder: 40,
  },
  {
    code: "SPECIALIST_PRO_10",
    category: "specialist",
    nameZh: "å°ˆæ¥­ç­–åŠƒå¸«",
    nameEn: "Professional Specialist",
    description: "å®Œæˆ 10 å–®æœå‹™",
    descriptionEn: "Complete 10 service orders",
    rarity: 3,
    triggerCondition: { type: "count", target: "specialist_orders", value: 10 },
    expReward: 200,
    otherRewards: { frame: "specialist" },
    sortOrder: 41,
  },
  {
    code: "FIVE_STAR_SPECIALIST",
    category: "specialist",
    nameZh: "äº”æ˜Ÿç­–åŠƒå¸«",
    nameEn: "Five Star Specialist",
    description: "ç´¯è¨ˆ 50 å€‹å¥½è©•",
    descriptionEn: "Receive 50 positive reviews",
    rarity: 4,
    triggerCondition: { type: "count", target: "specialist_good_reviews", value: 50 },
    expReward: 500,
    otherRewards: { title: "äº”æ˜Ÿ" },
    sortOrder: 42,
  },
  {
    code: "JOURNEY_MASTER_100",
    category: "specialist",
    nameZh: "æ—…é€”å¤§å¸«",
    nameEn: "Journey Master",
    description: "å®Œæˆ 100 å–®æœå‹™",
    descriptionEn: "Complete 100 service orders",
    rarity: 4,
    triggerCondition: { type: "count", target: "specialist_orders", value: 100 },
    expReward: 500,
    otherRewards: { frame: "legend_specialist" },
    sortOrder: 43,
  },
];

async function seed() {
  console.log("ğŸŒ± é–‹å§‹æ¤å…¥éŠæˆ²ç¶“æ¿Ÿç³»çµ±åˆå§‹è³‡æ–™...");

  try {
    // æ¤å…¥ç­‰ç´šå®šç¾©
    console.log("ğŸ“Š æ¤å…¥ç­‰ç´šå®šç¾©...");
    for (const level of levelData) {
      await db.insert(levelDefinitions).values(level).onConflictDoNothing();
    }
    console.log(`âœ… å·²æ¤å…¥ ${levelData.length} å€‹ç­‰ç´šå®šç¾©`);

    // æ¤å…¥æˆå°±å®šç¾©
    console.log("ğŸ† æ¤å…¥æˆå°±å®šç¾©...");
    for (const achievement of achievementData) {
      await db.insert(achievements).values(achievement as any).onConflictDoNothing();
    }
    console.log(`âœ… å·²æ¤å…¥ ${achievementData.length} å€‹æˆå°±å®šç¾©`);

    console.log("ğŸ‰ éŠæˆ²ç¶“æ¿Ÿç³»çµ±åˆå§‹è³‡æ–™æ¤å…¥å®Œæˆ!");
  } catch (error) {
    console.error("âŒ æ¤å…¥å¤±æ•—:", error);
    process.exit(1);
  }
}

// åŸ·è¡Œ
seed();
