#### 1. 地理範圍鎖定
*   **Step 1**: 選擇國家 -> 選擇行政區 $X$。
*   **Step 2**: 掃描 $X$ 下的子行政區列表（總數 $N$）。
*   **Step 3**: 隨機鎖定一個子行政區，機率為 $1/N$。
    *   *（註：所有生成的行程點建議優先落在該子行政區內，或其半徑 5-10 公里範圍內，避免交通跨度過大。）*

#### 2. 行程卡生成配額 (Quota System)
設定總卡片數為 $K$ ($5 \le K \le 12$)。

*   **基礎限制檢查**：
    *   **若 $K < 8$**：`宿` = 0 (強制不生成住宿)。
    *   **若 $K \ge 8$**：`宿` = 1 (通常一天只需一個住宿，除非是長途跨夜，建議設為固定 1 或 0)。
    *   **餐飲 ("食") 最低配額**：
        *   你原本的邏輯：($K<6$ 至少2食)、($K<9$ 至少3食)。
        *   *分析：$K<6$ 的情況必定滿足 $K<9$，所以邏輯會重疊。建議簡化為：*
        *   若 $K \in [5, 6]$：`食` $\ge 2$。
        *   若 $K \in [7, 8]$：`食` $\ge 3$。
        *   若 $K \ge 9$：`食` $\ge 3$ (或建議 4，含宵夜/下午茶)。

#### 3. 類別填充與多樣性 (Category & Variety)
*   **剩餘卡片生成**：扣除上述強制配額後，剩餘卡片依據 8 大類別平均機率 ($1/8$) 抽取。
*   **子分類細化**：
    *   鎖定大類別後，撈取該類別下 $M$ 個子分類，機率 $1/M$。
    *   **關鍵邏輯**：檢查同一份行程單中，**子分類不得重複** (例如：若已有「火鍋」，下一餐不可再選「火鍋」，需選「飯麵」或「異國料理」)。

#### 4. 時序與合理性檢查 (Validation Rules)
*   **時間窗標籤 (Time-Slot Tagging)**：
    *   `食`：早餐 (06-10)、午餐 (11-14)、下午茶 (14-17)、晚餐 (17-20)、宵夜/酒吧 (20-02)。
    *   `景點/體驗`：需標記「僅日間開放」或「全天開放」。
*   **互斥規則 (Exclusion)**：
    *   同一時段不可安排 2 個行程。
    *   同一天不安排 2 個住宿。
    *   同一餐期不安排 2 個正餐 (例如：12:00 吃完排餐，13:00 不可再吃鐵板燒)。

---

### 第二部分：分析與優化建議 (如何讓 AI 生成更像「人」排的行程)

目前的邏輯偏向「隨機生成」，很容易出現**節奏怪異**的行程。為了讓 AI 產出更具可執行性的行程，建議加入以下 4 個維度的考量：

#### 1. 加入「停留時間 (Duration)」與「營業時間 (Operating Hours)」參數
目前的邏輯只考慮「時間點」，未考慮「時長」。
*   **問題**：AI 可能會安排：10:00 逛博物館 -> 10:30 吃午餐。但博物館通常需要逛 2-3 小時。
*   **建議條件**：
    *   為每個類別設定**預設停留時間**。
        *   `景點`、`遊程體驗`：預設 1.5 - 3 小時。
        *   `食` (正餐)：1 - 1.5 小時。
        *   `食` (小吃/飲料)：30 分鐘。
        *   `購物`：45 - 90 分鐘。
    *   **營業時間檢核**：如果是「生態文化教育」或「景點」，需避開 17:00 後（多數展館閉館）。

#### 2. 加入「地理路徑順暢度 (Routing Heuristic)」
即使都在同一個子行政區，若是東邊一個點、西邊一個點，來回跑會很累。
*   **建議條件**：
    *   若 AI 知道具體座標，請加入**「鄰近優先」**演算法。
    *   若 AI 不知道座標，請加入指令：**「請依照該子行政區的地理聚落或商圈進行群聚安排，避免同一天內多次大幅度折返。」**

#### 3. 優化「食」的權重分配 (Weighting Adjustment)
你設定所有類別機率為 1/8，這在真實旅遊中是不自然的。
*   **問題**：$1/8$ 機率下，抽到「住宿」跟「購物」的機率一樣高。但一天通常要吃 3 餐，卻不一定會買 1 次東西或看 1 個展覽。
*   **建議條件**：
    *   **動態權重**：
        *   `食`：權重調高 (High)。
        *   `景點`、`遊程體驗`、`生態`：權重中等 (Medium)。
        *   `宿`、`購物`、`娛樂`：權重較低 (Low)。
    *   或者使用**「插槽模式 (Slot Logic)」**：
        *   先建立骨架：[早餐] -> [上午活動] -> [午餐] -> [下午活動] -> [晚餐]。
        *   再將行程卡填入對應的插槽，這樣比純機率生成更穩定。

#### 4. 增加「動靜穿插」的節奏感 (Pacing)
*   **問題**：隨機生成可能導致連續 3 個「生態文化教育」（連續逛 3 個博物館會累死），或是連續 3 個「娛樂設施」。
*   **建議條件**：
    *   **標籤互斥邏輯**：若上一個行程是「高體力消耗」（如登山、樂園），下一個行程應優先推薦「靜態/休息」（如咖啡廳、觀景車、靜態展覽）。
    *   **連續性限制**：同大類別行程（除「食」以外），不建議連續出現超過 2 次。

### 綜合修正後的 Prompt 邏輯範例 (可直接參考使用)

如果你要寫給 AI，可以加上這段補充指令：

> **【進階優化指令】**
> 1.  **合理化順序**：請依照「早餐 -> 上午行程 -> 午餐 -> 下午行程 -> 晚餐 -> 晚間行程/住宿」的時間軸進行排序。
> 2.  **避免疲勞**：`景點`、`遊程體驗`、`生態文化教育` 三者視為「活動類」，連續的「活動類」行程之間，建議穿插一個 `購物` 或 `食`(下午茶/點心) 作為緩衝。
> 3.  **多樣性權重**：在滿足「食」的最低數量後，剩餘卡片請優先分配給 `景點` 與 `遊程體驗`，確保這是一趟有內容的旅行，而非純粹的吃飯行程。
> 4.  **營業時間邏輯**：
>     *   `生態文化教育` (如博物館) 必須安排在 09:00-17:00 之間。
>     *   `娛樂設施` (如酒吧、夜市) 優先安排在 18:00 之後。
>     *   `宿` 必須安排在行程的最後一項 (若有)。
